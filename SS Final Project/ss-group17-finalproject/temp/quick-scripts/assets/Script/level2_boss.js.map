{"version":3,"sources":["level2_boss.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../assets/Script","sourcesContent":["\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class level2_boss extends cc.Component {\n\n    @property(cc.Node)\n    player: cc.Node = null;\n\n    @property(cc.Node)\n    shadow: cc.Node = null;\n\n    @property({type:cc.AudioClip})\n    hurt_sound: cc.AudioClip = null;\n\n    @property({type:cc.AudioClip})\n    dis_sound: cc.AudioClip = null;\n    private life = 5;\n    \n    private anim;\n    //-290, 230\n    //80, 230\n    //200, 25\n    //-205, 55\n    //-50, -35\n    //-200, -165\n    //90, -130\n    private pos_set = [cc.v2(-290, 320), cc.v2(80, 325), cc.v2(200, 120), \n        cc.v2(-205, 150), cc.v2(-50, 55), \n        cc.v2(-200, -40), cc.v2(90, -35)];\n\n    private state = 0;\n    //0: not moving\n    //1: playing moving anim\n    //2: hit\n    //3: dead\n    //4: win\n    \n    private is_registered: boolean = false;\n\n    private is_registered2: boolean = false;\n\n    private player_cooldown: boolean = false;\n\n    private detect_cooldown: boolean = false;\n\n    start () {\n        this.anim = this.getComponent(cc.Animation);\n        this.anim.on('finished', this.set_anim, this);\n        cc.director.getPhysicsManager().enabled = true;\n        this.schedule(()=>{\n            if(this.state != 3 && this.state != 4)\n                this.check_bullet();\n        },0.2);\n\n    }\n    set_anim(){\n        if(this.state != 3 && this.state != 4){\n            if(this.state == 2){\n                if(this.life > 0){\n                    this.state = 0;\n                    this.set_move_anim();\n                }\n                else{\n                    this.state = 3;\n                    this.scheduleOnce(()=>{\n                        cc.find(\"SceneManager\").getComponent(\"scene_manage\").go_animation(\"animation3\");\n                    }, 2);\n                }\n                return;\n            }\n            this.state = 0;\n        }\n    }\n    random_num(x){\n        return Math.floor(Math.random() * x);\n    }\n    check_bullet(){\n        this.player.parent.children.forEach((child_node)=>{\n            if(child_node.name == 'bullet'){\n                if(Math.abs(child_node.position.x - this.node.position.x) <= 80\n                && ((child_node.position.x - this.node.position.x >=0\n                && child_node.scaleX < 0) || (child_node.position.x - this.node.position.x < 0 && child_node.scaleX > 0))\n                && Math.abs(child_node.position.y - this.node.position.y) <= 50 \n                ){\n                    var move_or_not = this.random_num(11);\n                    //cc.log(move_or_not+'out');\n                    if(move_or_not <= 7 && !this.detect_cooldown){\n                        //cc.log(move_or_not);\n                        this.detect_cooldown = true;\n                        if(this.state == 0){\n                            this.set_move_anim();\n                        }\n                        //this.set_move_anim();\n                        //this.move_pos();\n                        this.scheduleOnce(()=>{\n                            this.detect_cooldown = false;\n                            //cc.log('set_back');\n                        }, 1);\n                    }\n                }\n            }\n        });\n    }\n    check_player(){\n        if(Math.abs(this.player.position.x - this.node.position.x) <= 100\n        && Math.abs(this.player.position.y - this.node.position.y) <= 50 \n        ){\n            if(!this.player_cooldown){\n                this.player_cooldown = true;\n                if(this.state == 0){\n                    this.set_move_anim();\n                }\n                this.scheduleOnce(()=>{\n                    this.player_cooldown = false;\n                    //cc.log('set_back');\n                }, 1);\n            }\n        }\n    }\n    set_move_anim(){\n        this.state = 1;\n        cc.audioEngine.playEffect(this.dis_sound, false);\n        //var s = this.anim.play('vanish_b2');\n        this.shadow.position = this.node.position;\n        this.move_pos();\n        var s = this.anim.play('show_b2');\n        this.shadow.getComponent(cc.Animation).play();\n\n    }\n    move_pos(){\n        var new_pos = this.random_num(7);\n        this.node.position = this.pos_set[new_pos];\n    }\n    check_scale(){\n        if(this.player.position.x - this.node.position.x >= 0){\n            this.node.scaleX = 1.5;\n        }else{\n            this.node.scaleX = -1.5;\n        }\n    }\n    onBeginContact(contact, self, other){\n        if(other.node.name == 'player_boss'){\n            contact.disabled = true;\n        }else if(other.node.name == 'bullet' && this.state != 3 && this.state !=4){\n            //cc.log('boss hit');\n            this.anim.play('hurt_b2');\n            cc.audioEngine.playEffect(this.hurt_sound, false);\n            this.state = 2;\n            this.life--;\n            cc.log(this.life);\n        }\n    }\n    \n    onPreSolve(contact, self, other){\n        if(other.node.name == 'player_boss')\n            contact.disabled = true;\n    }\n\n    animation_check(){\n        if(this.state == 0 && !this.anim.getAnimationState('idle_b2').isPlaying){\n            this.anim.play('idle_b2');\n        }\n    }\n\n    update (dt) {\n        //this.check_bullet();\n        if(this.state != 3 && this.state != 4){\n            this.check_scale();\n            this.animation_check();\n            this.check_player();\n        }\n    }\n}\n"]}