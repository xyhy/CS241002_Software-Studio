{"version":3,"sources":["dialogue.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../assets/Script","sourcesContent":["\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class NewClass extends cc.Component {\r\n\r\n\r\n    //Label of text content.\r\n    @property(cc.Label)\r\n    textLabel: cc.Label = null;\r\n\r\n    //Label of role name (who is talking).\r\n    @property(cc.Label)\r\n    nameLabel: cc.Label = null;\r\n\r\n    //Sprite of dialog box.\r\n    @property(cc.Sprite)\r\n    picSprite: cc.Sprite = null;\r\n\r\n    //Index of current sentence.\r\n    @property()\r\n    textIndex: number = 0;\r\n\r\n    //Sound effect of typing\r\n    @property({type: cc.AudioClip})\r\n    typingSound: cc.AudioClip = null;\r\n\r\n    private isEnd: boolean = false;\r\n\r\n    //Array includes every sentences, role name, and text content.\r\n    private textContentArr: Array<string> = null;\r\n\r\n    //To record the text content of current sentence.\r\n    private curText: string = null;\r\n\r\n    //To show if current sentence is still playing (typing).\r\n    private textEnd: boolean = true;\r\n\r\n    //To calculate typing time of each word.\r\n    private totalTime = 0;\r\n\r\n    public content = [{role:'姓名', content:'對話框內容縮排測試對話框內容縮排測試'},\r\n    {role:'姓名', content: '第二句話內容測試'}];\r\n\r\n    onLoad() {\r\n        //Initialize.\r\n        //this.init(this.content);\r\n        //Keyboard event listener (when SHIFT is pressed, change to next sentence).\r\n        cc.systemEvent.on('keydown', this.onKeyDown, this);\r\n        this.schedule(function(){this.nextTextContent()}, 2);\r\n        //Mouse event listener (when Mouse down, change to next sentence).\r\n        //this.node.on(cc.Node.EventType.MOUSE_DOWN, this.nextTextContent, this);\r\n    }\r\n\r\n    update (dt) {\r\n        if(!this.curText) return;\r\n        this.totalTime += dt;\r\n        if(this.totalTime >= 0.1) {//Typing 1 word every 0.1 sec\r\n            if(this.textLabel.string.length < this.curText.length) {\r\n                cc.audioEngine.playEffect(this.typingSound, false);\r\n                this.textLabel.string = this.curText.slice(0, this.textLabel.string.length + 1);\r\n            }\r\n            else {\r\n                this.textEnd = true;\r\n                this.curText = null;\r\n            }\r\n            this.totalTime = 0;\r\n        }\r\n    }\r\n\r\n    onDestroy() {\r\n        cc.systemEvent.off('keydown', this.onKeyDown, this);\r\n    }\r\n\r\n    onKeyDown(e) {\r\n        switch (e.keyCode) {\r\n            case cc.macro.KEY.shift: {\r\n                this.nextTextContent();\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    //Initialize.\r\n    init(textContentArr) {\r\n        if(cc.find(\"SceneManager\").getComponent(\"scene_manage\").get_first_time()){\r\n            this.textIndex = -1;\r\n            this.node.active = true;\r\n            this.textContentArr = textContentArr;\r\n            this.nextTextContent();\r\n        }\r\n        else this.node.destroy();\r\n    }\r\n\r\n    //Change to next sentence.\r\n    nextTextContent() {\r\n        //If current sentence are still playing, can't change to next dialog.\r\n        if(!this.textEnd) return;\r\n        if(++this.textIndex < this.textContentArr.length) {//Have another words to say\r\n            this.setTextContent(this.textContentArr[this.textIndex]);\r\n        }\r\n        else {\r\n            this.closeDialogBox();\r\n        }\r\n    }\r\n\r\n    //Change the text context of each sentence.\r\n    setTextContent(textContent) {\r\n        if(!this.textEnd) return;\r\n        this.textEnd = false;\r\n\r\n        this.nameLabel.string = textContent.role;\r\n        this.textLabel.string = '';\r\n        this.curText = textContent.content;\r\n    }\r\n\r\n    //Close the dialog box.\r\n    closeDialogBox() {\r\n        this.isEnd = true;\r\n        this.node.runAction(cc.fadeOut(0.2));\r\n        this.unschedule(function(){this.nextTextContent()});\r\n        this.scheduleOnce(function(){this.node.destroy()}, 0.2);\r\n        if(cc.director.getScene().name[0] == 'a'){\r\n            cc.log(\"finish\");\r\n            cc.find(\"anima\").getComponent(\"anima\").animation_finish();\r\n        }\r\n    }\r\n}\r\n"]}