{"version":3,"sources":["../../../../assets/Script/assets/Script/test.ts"],"names":[],"mappings":";;;;;AAAM,IAAA,kBAAmC,EAAlC,oBAAO,EAAE,sBAAyB,CAAC;AAG1C;IAAyC,+BAAY;IADrD;QAAA,qEAqDC;QA7CW,oBAAc,GAAW,IAAI,CAAC;;IA6C1C,CAAC;IA5CU,2BAAK,GAAZ;QAAA,iBAmBC;QAlBG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;QAEhE,yBAAyB;QACzB,IAAI,KAAK,GAAG,EAAE,CAAC,OAAO,CAAC,KAAK,GAAG,EAAE,CAAC,OAAO,CAAC,MAAM,CAAC;QACjD,kBAAkB;QAClB,eAAe;QACf,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;QAC5C,OAAO;QACP,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;QAC/C,iBAAiB;QACjB,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,cAAc,EAAE,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC;QAC1D,sBAAsB;QACtB,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,kBAAkB,EAAE,IAAI,CAAC,CAAC;QACnD,iBAAiB;QACjB,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,gBAAgB,EAAE,CAAC,CAAC,CAAC;QAC9C,eAAe;QACf,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,aAAa,EAAE,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QACjE,IAAI,CAAC,YAAY,CAAC,cAAK,KAAI,CAAC,cAAc,EAAE,CAAC,CAAA,CAAC,EAAE,CAAC,CAAC,CAAC;IACvD,CAAC;IAED,4BAAM,GAAN,UAAO,EAAE;QACL,IAAI,WAAW,GAAG,EAAE,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;QACrD,IAAI,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,qBAAqB,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,CAAC;QACxF,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,cAAc,EAAE,MAAM,CAAC,CAAC;IAErD,CAAC;IAED,oCAAc,GAAd;QAAA,iBASC;QARG,IAAI,CAAC,QAAQ,CAAC;YACV,IAAG,KAAI,CAAC,cAAc,IAAI,CAAC,EAAC;gBACxB,KAAI,CAAC,cAAc,GAAG,CAAC,CAAC;aAC3B;iBAAI;gBACD,KAAI,CAAC,cAAc,IAAI,IAAI,CAAC;aAC/B;YACD,KAAI,CAAC,OAAO,CAAC,WAAW,CAAC,kBAAkB,EAAE,KAAI,CAAC,cAAc,CAAC,CAAC;QACtE,CAAC,EAAC,IAAI,CAAC,CAAC;IACZ,CAAC;IACD,uBAAuB;IAChB,oCAAc,GAArB,UAAsB,GAAY;QAC9B,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;QAC3C,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;QAC5C,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IACvB,CAAC;IAnDgB,WAAW;QAD/B,OAAO;OACa,WAAW,CAoD/B;IAAD,kBAAC;CApDD,AAoDC,CApDwC,EAAE,CAAC,SAAS,GAoDpD;kBApDoB,WAAW","file":"","sourceRoot":"../../../../assets/Script","sourcesContent":["const {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class SearchLight extends cc.Component {\n\n    \n\n    // 材质对象\n    private _materi: cc.Material;\n\n    private light_strength: number = 0.05;\n    public start() {\n        this._materi = this.node.getComponent(cc.Sprite).getMaterial(0);\n        \n        // 计算窗口或界面的宽高比，该例子是屏幕的宽高比\n        let ratio = cc.winSize.width / cc.winSize.height;\n        // 获取材质并初始化纹理的各个属性\n        // 屏幕宽高比，用于纠正坐标\n        this._materi.setProperty(\"wh_ratio\", ratio);  \n        // 光源半径\n        this._materi.setProperty(\"light_radius\", 0.02);   \n        // 光源中心点，默认设置到屏幕外\n        this._materi.setProperty(\"light_center\", cc.v2(2.0, 2.0)); \n        // 环境光强度，就是光源没照到的地方亮度。\n        this._materi.setProperty(\"ambient_strength\", 0.05);  \n        // 光源强度，这里设置为最大1。\n        this._materi.setProperty(\"light_strength\", 1); \n        // 光源颜色，这里设置为白光\n        this._materi.setProperty(\"light_color\", new cc.Vec4(1, 0, 0, 1)); \n        this.scheduleOnce(()=>{this.start_to_light();}, 5);\n    }\n\n    update(dt){\n        var player_node = cc.find('All Nodes/Canvas/player');\n        let center = this.getLightCenter(this.node.convertToWorldSpaceAR(player_node.position));\n        this._materi.setProperty(\"light_center\", center);\n        \n    }\n    \n    start_to_light(){\n        this.schedule(()=>{\n            if(this.light_strength >= 1){\n                this.light_strength = 1;\n            }else{\n                this.light_strength += 0.05;\n            }\n            this._materi.setProperty(\"ambient_strength\", this.light_strength);\n        },0.05);\n    }\n    /** 根据touch坐标计算光源中心点 */\n    public getLightCenter(pos: cc.Vec2): cc.Vec2 {\n        let x = pos.x / (cc.winSize.width / 2) - 1;\n        let y = pos.y / (cc.winSize.height / 2) - 1;\n        return cc.v2(x, y);\n    }\n}"]}